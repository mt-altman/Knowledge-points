<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elasticsearch æŸ¥è¯¢ä¸èšåˆåŸºç¡€æŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        .sidebar {
            transition: all 0.3s;
        }
        .toc-link {
            display: block;
            padding: 5px 0;
            color: #333;
            text-decoration: none;
            border-left: 2px solid transparent;
            padding-left: 10px;
            transition: all 0.2s;
        }
        .toc-link:hover {
            color: #5046e5;
            border-left: 2px solid #5046e5;
            background-color: rgba(80, 70, 229, 0.05);
        }
        .toc-link.active {
            color: #5046e5;
            border-left: 2px solid #5046e5;
            background-color: rgba(80, 70, 229, 0.1);
            font-weight: 500;
        }
        .content pre {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            overflow-x: auto;
        }
        .content code {
            font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.9em;
            background-color: rgba(80, 70, 229, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
            color: #5046e5;
        }
        .content pre code {
            background-color: transparent;
            padding: 0;
            border-radius: 0;
            color: #333;
        }
        .toc-level-2 {
            margin-left: 10px;
        }
        .toc-level-3 {
            margin-left: 20px;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 40;
                height: 100vh;
            }
            .sidebar.open {
                transform: translateX(0);
            }
        }
    /* è¿”å›é¦–é¡µæŒ‰é’®æ ·å¼ */
        .home-button-fixed {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            text-decoration: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s, transform 0.2s;
        }
        .home-button-fixed:hover {
            background-color: #2980b9;
            transform: translateY(-50%) translateX(2px);
        }
        .home-button-fixed svg {
            width: 20px;
            height: 20px;
        }
        @media (max-width: 768px) {
            .home-button-fixed {
                top: 50%;
                left: 10px;
                width: 36px;
                height: 36px;
            }
            .home-button-fixed svg {
                width: 18px;
                height: 18px;
            }
        }</style>
</head>
<body class="bg-gray-50"><a href="../index.html" class="home-button-fixed" title="è¿”å›é¦–é¡µ"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></a>
    <div class="relative min-h-screen">
        <!-- Mobile menu button -->
        <button id="menu-toggle" class="lg:hidden fixed bottom-6 right-6 z-50 bg-indigo-600 text-white p-3 rounded-full shadow-lg">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar w-64 bg-white shadow-md fixed h-screen overflow-y-auto p-4 lg:translate-x-0">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-indigo-700">
                    <i class="fas fa-book mr-2"></i>ç›®å½•
                </h2>
                <button id="close-menu" class="lg:hidden text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav id="toc" class="toc">
                <a href="#introduction" class="toc-link">ğŸ“š 1. Elasticsearch æŸ¥è¯¢ä¸èšåˆç®€ä»‹</a>
                <a href="#query-basics" class="toc-link">ğŸ” 2. æŸ¥è¯¢åŸºç¡€</a>
                <a href="#match-query" class="toc-link toc-level-2">2.1 Match æŸ¥è¯¢</a>
                <a href="#term-query" class="toc-link toc-level-2">2.2 Term æŸ¥è¯¢</a>
                <a href="#range-query" class="toc-link toc-level-2">2.3 Range æŸ¥è¯¢</a>
                <a href="#bool-query" class="toc-link toc-level-2">2.4 Bool å¤åˆæŸ¥è¯¢</a>
                <a href="#query-string" class="toc-link toc-level-2">2.5 Query String æŸ¥è¯¢</a>
                <a href="#aggregation-basics" class="toc-link">ğŸ“Š 3. èšåˆåŸºç¡€</a>
                <a href="#bucket-aggs" class="toc-link toc-level-2">3.1 Bucket èšåˆ</a>
                <a href="#metric-aggs" class="toc-link toc-level-2">3.2 Metric èšåˆ</a>
                <a href="#pipeline-aggs" class="toc-link toc-level-2">3.3 Pipeline èšåˆ</a>
                <a href="#combined-query-agg" class="toc-link">ğŸ”„ 4. ç»„åˆæŸ¥è¯¢ä¸èšåˆ</a>
                <a href="#pagination-sorting" class="toc-link">ğŸ“‘ 5. åˆ†é¡µä¸æ’åº</a>
                <a href="#highlighting" class="toc-link">âœ¨ 6. é«˜äº®æœç´¢ç»“æœ</a>
                <a href="#performance-tips" class="toc-link">âš¡ 7. æ€§èƒ½ä¼˜åŒ–æç¤º</a>
                <a href="#conclusion" class="toc-link">ğŸ 8. æ€»ç»“</a>
            </nav>
        </aside>

        <!-- Main content -->
        <main class="content lg:ml-64 p-6 lg:p-8">
            <article class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6 lg:p-10">
                <h1 class="text-3xl font-bold text-indigo-800 mb-6">Elasticsearch æŸ¥è¯¢ä¸èšåˆåŸºç¡€æŒ‡å—</h1>
              
                <section id="introduction" class="mb-10">
                    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">
                        <i class="fas fa-book mr-2"></i>1. Elasticsearch æŸ¥è¯¢ä¸èšåˆç®€ä»‹
                    </h2>
                    <p class="mb-4">Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€RESTful é£æ ¼çš„æœç´¢å’Œåˆ†æå¼•æ“ï¼ŒåŸºäº Apache Lucene æ„å»ºã€‚å®ƒèƒ½å¤Ÿä»¥è¿‘å®æ—¶çš„æ–¹å¼å­˜å‚¨ã€æœç´¢å’Œåˆ†æå¤§é‡æ•°æ®ã€‚</p>
                  
                    <div class="bg-indigo-50 p-4 rounded-lg mb-4">
                        <p class="font-medium text-indigo-800">Elasticsearch ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š</p>
                        <ul class="list-disc list-inside ml-4 mt-2">
                            <li><strong>æŸ¥è¯¢(Query)</strong>ï¼šç”¨äºæ£€ç´¢åŒ¹é…ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£</li>
                            <li><strong>èšåˆ(Aggregation)</strong>ï¼šç”¨äºåˆ†æå’Œæ±‡æ€»æ•°æ®</li>
                        </ul>
                    </div>
                  
                    <div class="mb-6">
                        <div class="mermaid">
                        graph TD
                            A[Elasticsearch API] --> B[æŸ¥è¯¢ DSL]
                            A --> C[èšåˆ API]
                            B --> D[å…¨æ–‡æŸ¥è¯¢]
                            B --> E[Term çº§åˆ«æŸ¥è¯¢]
                            B --> F[å¤åˆæŸ¥è¯¢]
                            C --> G[Bucket èšåˆ]
                            C --> H[Metric èšåˆ]
                            C --> I[Pipeline èšåˆ]
                            C --> J[Matrix èšåˆ]
                        </div>
                    </div>
                  
                    <p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Elasticsearch çš„æŸ¥è¯¢ DSLï¼ˆé¢†åŸŸç‰¹å®šè¯­è¨€ï¼‰å’ŒèšåˆåŠŸèƒ½æ¥æœ‰æ•ˆåœ°æ£€ç´¢å’Œåˆ†ææ•°æ®ã€‚</p>
                </section>
              
                <section id="query-basics" class="mb-10">
                    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">
                        <i class="fas fa-search mr-2"></i>2. æŸ¥è¯¢åŸºç¡€
                    </h2>
                    <p class="mb-4">Elasticsearch æä¾›äº†ä¸€ç§åŸºäº JSON çš„æŸ¥è¯¢è¯­è¨€ï¼ˆQuery DSLï¼‰æ¥å®šä¹‰æŸ¥è¯¢ã€‚æŸ¥è¯¢å¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
                  
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <h3 class="font-medium text-indigo-800 mb-2">å¶æŸ¥è¯¢å­å¥</h3>
                            <p>åœ¨ç‰¹å®šå­—æ®µä¸­æŸ¥æ‰¾ç‰¹å®šå€¼çš„æŸ¥è¯¢ï¼ˆå¦‚ matchã€termã€rangeï¼‰ã€‚è¿™äº›æŸ¥è¯¢å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚</p>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <h3 class="font-medium text-indigo-800 mb-2">å¤åˆæŸ¥è¯¢å­å¥</h3>
                            <p>åŒ…å«å…¶ä»–å¶æŸ¥è¯¢æˆ–å¤åˆæŸ¥è¯¢çš„æŸ¥è¯¢ï¼ˆå¦‚ boolã€dis_maxï¼‰ï¼Œç”¨äºç»„åˆå¤šä¸ªæŸ¥è¯¢ã€‚</p>
                        </div>
                    </div>
                  
                    <p class="mb-4">åŸºæœ¬çš„æŸ¥è¯¢è¯·æ±‚ç»“æ„å¦‚ä¸‹ï¼š</p>
                  
<pre><code>{
  "query": {
    "æŸ¥è¯¢ç±»å‹": {
      "å‚æ•°1": "å€¼1",
      "å‚æ•°2": "å€¼2"
    }
  }
}</code></pre>
                  
                    <section id="match-query" class="mt-6 mb-6">
                        <h3 class="text-xl font-semibold text-indigo-600 mb-3">2.1 Match æŸ¥è¯¢</h3>
                        <p class="mb-2">Match æŸ¥è¯¢æ˜¯å…¨æ–‡æŸ¥è¯¢çš„æ ‡å‡†æŸ¥è¯¢ï¼Œå¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œåˆ†æï¼ˆå¦‚åˆ†è¯ï¼‰ï¼Œç„¶åæ„å»ºæŸ¥è¯¢ã€‚</p>
                      
<pre><code>GET /my_index/_search
{
  "query": {
    "match": {
      "title": "elasticsearch guide"
    }
  }
}</code></pre>
                      
                        <p class="mt-2">ä¸Šè¿°æŸ¥è¯¢ä¼šæœç´¢ title å­—æ®µä¸­åŒ…å« "elasticsearch" æˆ– "guide" çš„æ–‡æ¡£ã€‚</p>
                      
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-3">
                            <p class="text-sm text-yellow-700">
                                <strong>æ³¨æ„ï¼š</strong> match æŸ¥è¯¢é»˜è®¤ä½¿ç”¨ OR æ“ä½œç¬¦ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® operator å‚æ•°ä¿®æ”¹ï¼š
                            </p>
                        </div>
                      
<pre><code>GET /my_index/_search
{
  "query": {
    "match": {
      "title": {
        "query": "elasticsearch guide",
        "operator": "and"
      }
    }
  }
}</code></pre>
                      
                        <p class="mt-2">è¿™æ ·å°±è¦æ±‚æ–‡æ¡£åŒæ—¶åŒ…å« "elasticsearch" å’Œ "guide" ä¸¤ä¸ªè¯ã€‚</p>
                    </section>
                  
                    <section id="term-query" class="mb-6">
                        <h3 class="text-xl font-semibold text-indigo-600 mb-3">2.2 Term æŸ¥è¯¢</h3>
                        <p class="mb-2">Term æŸ¥è¯¢ç”¨äºç²¾ç¡®å€¼åŒ¹é…ï¼Œä¸ä¼šå¯¹æœç´¢è¯è¿›è¡Œåˆ†æå¤„ç†ã€‚é€‚ç”¨äºå…³é”®å­—ã€æ•°å­—ã€æ—¥æœŸç­‰ç»“æ„åŒ–æ•°æ®ã€‚</p>
                      
<pre><code>GET /my_index/_search
{
  "query": {
    "term": {
      "status": {
        "value": "active"
      }
    }
  }
}</code></pre>
                      
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-3">
                            <div class="flex">
                                <div class="mr-3 text-blue-500">
                                    <i class="fas fa-info-circle text-xl"></i>
                                </div>
                                <p class="text-sm text-blue-700">
                                    <strong>æœ€ä½³å®è·µï¼š</strong> å¯¹äºæ–‡æœ¬å­—æ®µï¼Œç¡®ä¿ç†è§£åˆ†æä¸æœªåˆ†æå­—æ®µçš„åŒºåˆ«ã€‚å¦‚æœéœ€è¦ç²¾ç¡®åŒ¹é…ï¼Œä½¿ç”¨ keyword ç±»å‹å­—æ®µæˆ– .keyword å­å­—æ®µã€‚
                                </p>
                            </div>
                        </div>
                    </section>
                  
                    <section id="range-query" class="mb-6">
                        <h3 class="text-xl font-semibold text-indigo-600 mb-3">2.3 Range æŸ¥è¯¢</h3>
                        <p class="mb-2">Range æŸ¥è¯¢ç”¨äºæŸ¥æ‰¾å­—æ®µå€¼åœ¨æŒ‡å®šèŒƒå›´å†…çš„æ–‡æ¡£ï¼Œé€‚ç”¨äºæ•°å­—ã€æ—¥æœŸç­‰ç±»å‹ã€‚</p>
                      
<pre><code>GET /my_index/_search
{
  "query": {
    "range": {
      "age": {
        "gte": 20,
        "lte": 40
      }
    }
  }
}</code></pre>
                      
                        <p class="mt-2">å¸¸ç”¨çš„èŒƒå›´æ“ä½œç¬¦ï¼š</p>
                        <ul class="list-disc list-inside ml-4">
                            <li><code>gt</code> - å¤§äº</li>
                            <li><code>gte</code> - å¤§äºç­‰äº</li>
                            <li><code>lt</code> - å°äº</li>
                            <li><code>lte</code> - å°äºç­‰äº</li>
                        </ul>
                      
                        <p class="mt-2">å¯¹äºæ—¥æœŸç±»å‹çš„èŒƒå›´æŸ¥è¯¢ï¼š</p>
                      
<pre><code>GET /my_index/_search
{
  "query": {
    "range": {
      "created_at": {
        "gte": "2021-01-01",
        "lte": "now",
        "format": "yyyy-MM-dd"
      }
    }
  }
}</code></pre>
                    </section>
                  
                    <section id="bool-query" class="mb-6">
                        <h3 class="text-xl font-semibold text-indigo-600 mb-3">2.4 Bool å¤åˆæŸ¥è¯¢</h3>
                        <p class="mb-2">Bool æŸ¥è¯¢å…è®¸æ‚¨ç»„åˆå¤šä¸ªæŸ¥è¯¢å­å¥ï¼Œæ˜¯æ„å»ºå¤æ‚æŸ¥è¯¢çš„åŸºç¡€ã€‚</p>
                      
                        <p>Bool æŸ¥è¯¢åŒ…å«å››ç§å­å¥ç±»å‹ï¼š</p>
                        <ul class="list-disc list-inside ml-4 mb-4">
    <li><code>must</code>ï¼šæ–‡æ¡£å¿…é¡»åŒ¹é…è¿™äº›æ¡ä»¶ï¼Œç±»ä¼¼äº AND</li>
    <li><code>should</code>ï¼šæ–‡æ¡£åº”è¯¥åŒ¹é…è¿™äº›æ¡ä»¶ï¼Œç±»ä¼¼äº OR</li>
    <li><code>must_not</code>ï¼šæ–‡æ¡£ä¸èƒ½åŒ¹é…è¿™äº›æ¡ä»¶ï¼Œç±»ä¼¼äº NOT</li>
    <li><code>filter</code>ï¼šå¿…é¡»åŒ¹é…ï¼Œä½†ä¸å½±å“ç›¸å…³æ€§è¯„åˆ†</li>
</ul>

<pre><code>GET /my_index/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "title": "elasticsearch" } }
      ],
      "should": [
        { "match": { "content": "search" } },
        { "match": { "content": "analysis" } }
      ],
      "must_not": [
        { "term": { "status": "deleted" } }
      ],
      "filter": [
        { "range": { "publish_date": { "gte": "2020-01-01" } } }
      ]
    }
  }
}</code></pre>

<div class="bg-green-50 border-l-4 border-green-400 p-4 mt-3">
    <div class="flex">
        <div class="mr-3 text-green-500">
            <i class="fas fa-lightbulb text-xl"></i>
        </div>
        <p class="text-sm text-green-700">
            <strong>æ€§èƒ½æç¤ºï¼š</strong> ä¼˜å…ˆä½¿ç”¨ filter è€Œé mustï¼Œå› ä¸º filter å­å¥ä¸è®¡ç®—åˆ†æ•°ä¸”ç»“æœå¯è¢«ç¼“å­˜ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚
        </p>
    </div>
</div>
</section>

<section id="query-string" class="mb-6">
    <h3 class="text-xl font-semibold text-indigo-600 mb-3">2.5 Query String æŸ¥è¯¢</h3>
    <p class="mb-2">Query String æŸ¥è¯¢æä¾›äº†ä¸€ç§ç´§å‡‘çš„æ–¹å¼æ¥ä½¿ç”¨æŸ¥è¯¢è¯­æ³•è¿›è¡Œæœç´¢ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨æ“ä½œç¬¦ï¼ˆANDã€ORã€NOTï¼‰å’Œé€šé…ç¬¦ç­‰ã€‚</p>
  
<pre><code>GET /my_index/_search
{
  "query": {
    "query_string": {
      "query": "elasticsearch AND (guide OR tutorial)",
      "fields": ["title", "content"]
    }
  }
}</code></pre>

    <p class="mt-2">æ”¯æŒçš„è¯­æ³•åŒ…æ‹¬ï¼š</p>
    <ul class="list-disc list-inside ml-4">
        <li>é€»è¾‘æ“ä½œç¬¦ï¼š<code>AND</code>, <code>OR</code>, <code>NOT</code></li>
        <li>å­—æ®µé™å®šï¼š<code>title:elasticsearch</code></li>
        <li>é€šé…ç¬¦ï¼š<code>elastic*</code>, <code>?earch</code></li>
        <li>æ­£åˆ™è¡¨è¾¾å¼ï¼š<code>/elastics[ae]arch/</code></li>
        <li>æ¨¡ç³ŠåŒ¹é…ï¼š<code>elasticsearch~2</code></li>
        <li>èŒƒå›´æŸ¥è¯¢ï¼š<code>age:[20 TO 30]</code>, <code>date:{2020-01-01 TO 2020-12-31}</code></li>
    </ul>
</section>
</section>

<section id="aggregation-basics" class="mb-10">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">
        <i class="fas fa-chart-pie mr-2"></i>3. èšåˆåŸºç¡€
    </h2>
    <p class="mb-4">èšåˆæä¾›äº†åˆ†ç»„å’Œæå–æ•°æ®çš„èƒ½åŠ›ã€‚èšåˆå¯ä»¥çœ‹ä½œæ˜¯SQLä¸­GROUP BYå’Œèšåˆå‡½æ•°çš„Elasticsearchç­‰ä»·ç‰©ã€‚</p>
  
    <div class="mb-6">
        <div class="mermaid">
        graph LR
            A[Elasticsearchèšåˆ] --> B[Bucketèšåˆ]
            A --> C[Metricèšåˆ]
            A --> D[Pipelineèšåˆ]
            A --> E[Matrixèšåˆ]
            B --> F[Terms]
            B --> G[Date Range]
            B --> H[Histogram]
            C --> I[Sum]
            C --> J[Avg]
            C --> K[Stats]
            D --> L[Avg Bucket]
            D --> M[Cumulative Sum]
        </div>
    </div>
  
    <p class="mb-4">èšåˆè¯­æ³•çš„åŸºæœ¬ç»“æ„ï¼š</p>
  
<pre><code>{
  "aggs": {
    "èšåˆåç§°": {
      "èšåˆç±»å‹": {
        "å­—æ®µ": "å­—æ®µåç§°",
        "å…¶ä»–å‚æ•°": "å€¼"
      }
    }
  }
}</code></pre>

    <section id="bucket-aggs" class="mt-6 mb-6">
        <h3 class="text-xl font-semibold text-indigo-600 mb-3">3.1 Bucket èšåˆ</h3>
        <p class="mb-2">Bucket èšåˆå°†æ–‡æ¡£åˆ†ç»„åˆ°ä¸åŒçš„æ¡¶(buckets)ä¸­ï¼Œç±»ä¼¼äº SQL ä¸­çš„ GROUP BYã€‚</p>
      
        <h4 class="font-medium text-indigo-700 mt-4 mb-2">Terms èšåˆ</h4>
        <p class="mb-2">åˆ›å»ºåŸºäºå­—æ®µå€¼çš„åˆ†ç»„ï¼š</p>
      
<pre><code>GET /my_index/_search
{
  "size": 0,
  "aggs": {
    "status_counts": {
      "terms": {
        "field": "status.keyword",
        "size": 10
      }
    }
  }
}</code></pre>

        <p class="mt-2">ä¸Šé¢çš„æŸ¥è¯¢ä¼šè¿”å›æŒ‰ status å­—æ®µåˆ†ç»„çš„æ–‡æ¡£è®¡æ•°ã€‚</p>
      
        <h4 class="font-medium text-indigo-700 mt-4 mb-2">Date Histogram èšåˆ</h4>
        <p class="mb-2">æŒ‰æ—¶é—´é—´éš”åˆ†ç»„ï¼š</p>
      
<pre><code>GET /my_index/_search
{
  "size": 0,
  "aggs": {
    "articles_over_time": {
      "date_histogram": {
        "field": "publish_date",
        "calendar_interval": "month",
        "format": "yyyy-MM"
      }
    }
  }
}</code></pre>

        <h4 class="font-medium text-indigo-700 mt-4 mb-2">Range èšåˆ</h4>
        <p class="mb-2">åˆ›å»ºè‡ªå®šä¹‰èŒƒå›´çš„æ¡¶ï¼š</p>
      
<pre><code>GET /my_index/_search
{
  "size": 0,
  "aggs": {
    "age_ranges": {
      "range": {
        "field": "age",
        "ranges": [
          { "to": 25 },
          { "from": 25, "to": 35 },
          { "from": 35 }
        ]
      }
    }
  }
}</code></pre>
    </section>
  
    <section id="metric-aggs" class="mb-6">
        <h3 class="text-xl font-semibold text-indigo-600 mb-3">3.2 Metric èšåˆ</h3>
        <p class="mb-2">Metric èšåˆè®¡ç®—ä¸€ç»„æ–‡æ¡£çš„å„ç§æŒ‡æ ‡ï¼Œç±»ä¼¼äº SQL ä¸­çš„èšåˆå‡½æ•°ï¼ˆSUM, AVG, MIN, MAXç­‰ï¼‰ã€‚</p>
      
        <h4 class="font-medium text-indigo-700 mt-4 mb-2">åŸºæœ¬åº¦é‡èšåˆ</h4>
      
<pre><code>GET /my_index/_search
{
  "size": 0,
  "aggs": {
    "avg_age": { "avg": { "field": "age" } },
    "max_age": { "max": { "field": "age" } },
    "min_age": { "min": { "field": "age" } },
    "sum_age": { "sum": { "field": "age" } }
  }
}</code></pre>

        <h4 class="font-medium text-indigo-700 mt-4 mb-2">Stats èšåˆ</h4>
        <p class="mb-2">ä¸€æ¬¡è®¡ç®—å¤šä¸ªç»Ÿè®¡æŒ‡æ ‡ï¼š</p>
      
<pre><code>GET /my_index/_search
{
  "size": 0,
  "aggs": {
    "age_stats": {
      "stats": {
        "field": "age"
      }
    }
  }
}</code></pre>

        <p class="mt-2">è¿”å›å­—æ®µçš„ countã€minã€maxã€avg å’Œ sumã€‚</p>
      
        <h4 class="font-medium text-indigo-700 mt-4 mb-2">Cardinality èšåˆ</h4>
        <p class="mb-2">è®¡ç®—å­—æ®µçš„å¤§è‡´åŸºæ•°ï¼ˆä¸åŒå€¼çš„æ•°é‡ï¼‰ï¼š</p>
      
<pre><code>GET /my_index/_search
{
  "size": 0,
  "aggs": {
    "unique_statuses": {
      "cardinality": {
        "field": "status.keyword"
      }
    }
  }
}</code></pre>
    </section>
  
    <section id="pipeline-aggs" class="mb-6">
        <h3 class="text-xl font-semibold text-indigo-600 mb-3">3.3 Pipeline èšåˆ</h3>
        <p class="mb-2">Pipeline èšåˆå¯¹å…¶ä»–èšåˆçš„è¾“å‡ºè¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯ç›´æ¥å¯¹æ–‡æ¡£è¿›è¡Œæ“ä½œã€‚</p>
      
        <h4 class="font-medium text-indigo-700 mt-4 mb-2">Avg Bucket èšåˆ</h4>
        <p class="mb-2">è®¡ç®—å¦ä¸€ä¸ªèšåˆä¸­å„ä¸ªæ¡¶çš„å¹³å‡å€¼ï¼š</p>
      
<pre><code>GET /my_index/_search
{
  "size": 0,
  "aggs": {
    "sales_per_month": {
      "date_histogram": {
        "field": "date",
        "calendar_interval": "month"
      },
      "aggs": {
        "sales": {
          "sum": {
            "field": "price"
          }
        }
      }
    },
    "avg_monthly_sales": {
      "avg_bucket": {
        "buckets_path": "sales_per_month>sales"
      }
    }
  }
}</code></pre>

        <h4 class="font-medium text-indigo-700 mt-4 mb-2">Cumulative Sum èšåˆ</h4>
        <p class="mb-2">è®¡ç®—ç´¯è®¡å’Œï¼š</p>
      
<pre><code>GET /my_index/_search
{
  "size": 0,
  "aggs": {
    "sales_per_month": {
      "date_histogram": {
        "field": "date",
        "calendar_interval": "month"
      },
      "aggs": {
        "sales": {
          "sum": {
            "field": "price"
          }
        },
        "cumulative_sales": {
          "cumulative_sum": {
            "buckets_path": "sales"
          }
        }
      }
    }
  }
}</code></pre>

        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-3">
            <div class="flex">
                <div class="mr-3 text-blue-500">
                    <i class="fas fa-info-circle text-xl"></i>
                </div>
                <p class="text-sm text-blue-700">
                    <strong>å…³é”®çŸ¥è¯†ç‚¹ï¼š</strong> Pipeline èšåˆä¸­çš„ <code>buckets_path</code> å‚æ•°ç”¨äºæŒ‡å®šè¦å¤„ç†çš„èšåˆè·¯å¾„ï¼Œæ ¼å¼ä¸º <code>èšåˆåç§°>å­èšåˆåç§°</code>ã€‚
                </p>
            </div>
        </div>
    </section>
</section>

<section id="combined-query-agg" class="mb-10">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">
        <i class="fas fa-code-branch mr-2"></i>4. ç»„åˆæŸ¥è¯¢ä¸èšåˆ
    </h2>
    <p class="mb-4">å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸éœ€è¦ç»“åˆæŸ¥è¯¢å’Œèšåˆï¼Œå¯¹è¿‡æ»¤åçš„æ•°æ®é›†è¿›è¡Œåˆ†æã€‚</p>
  
<pre><code>GET /my_index/_search
{
  "size": 0,
  "query": {
    "range": {
      "date": {
        "gte": "2020-01-01",
        "lte": "2020-12-31"
      }
    }
  },
  "aggs": {
    "categories": {
      "terms": {
        "field": "category.keyword",
        "size": 10
      },
      "aggs": {
        "avg_price": {
          "avg": {
            "field": "price"
          }
        },
        "top_products": {
          "top_hits": {
            "size": 3,
            "_source": ["name", "price"],
            "sort": [
              { "price": { "order": "desc" } }
            ]
          }
        }
      }
    }
  }
}</code></pre>

    <p class="mt-4">ä¸Šé¢çš„ç¤ºä¾‹ï¼š</p>
    <ol class="list-decimal list-inside ml-4 mb-4">
        <li>æŸ¥è¯¢ 2020 å¹´çš„æ‰€æœ‰æ–‡æ¡£</li>
        <li>æŒ‰ç±»åˆ«è¿›è¡Œåˆ†ç»„</li>
        <li>è®¡ç®—æ¯ä¸ªç±»åˆ«çš„å¹³å‡ä»·æ ¼</li>
        <li>è¿”å›æ¯ä¸ªç±»åˆ«ä¸­ä»·æ ¼æœ€é«˜çš„ä¸‰ä¸ªäº§å“</li>
    </ol>
  
    <div class="bg-indigo-50 p-4 rounded-lg mb-4">
        <p class="font-medium text-indigo-800">åµŒå¥—èšåˆçš„åº”ç”¨åœºæ™¯ï¼š</p>
        <ul class="list-disc list-inside ml-4 mt-2">
            <li>å¤šç»´æ•°æ®åˆ†æ</li>
            <li>æ—¶é—´åºåˆ—æ•°æ®çš„è¶‹åŠ¿åˆ†æ</li>
            <li>æŒ‰ç±»åˆ«çš„é”€å”®æ•°æ®åˆ†æ</li>
            <li>å±‚æ¬¡ç»“æ„æ•°æ®çš„å±•ç¤º</li>
        </ul>
    </div>
</section>

<section id="pagination-sorting" class="mb-10">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">
        <i class="fas fa-sort mr-2"></i>5. åˆ†é¡µä¸æ’åº
    </h2>
    <p class="mb-4">å¤„ç†å¤§é‡æœç´¢ç»“æœæ—¶ï¼Œåˆ†é¡µå’Œæ’åºæ˜¯å¿…ä¸å¯å°‘çš„åŠŸèƒ½ã€‚</p>
  
    <h3 class="text-xl font-semibold text-indigo-600 mb-3">åŸºç¡€åˆ†é¡µ</h3>
    <p class="mb-2">ä½¿ç”¨ from å’Œ size å‚æ•°è¿›è¡Œåˆ†é¡µï¼š</p>
  

  <pre><code>GET /my_index/_search
{
  "from": 10,  // è·³è¿‡å‰10ä¸ªç»“æœ
  "size": 20,  // è¿”å›20ä¸ªç»“æœ
  "query": {
    "match": {
      "content": "elasticsearch"
    }
  }
}</code></pre>

    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-3">
        <p class="text-sm text-yellow-700">
            <strong>æ³¨æ„ï¼š</strong> æ·±åº¦åˆ†é¡µï¼ˆå¤§çš„ from å€¼ï¼‰å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚Elasticsearch é»˜è®¤é™åˆ¶ from + size ä¸èƒ½è¶…è¿‡ 10,000ã€‚å¯¹äºå¤§å‹ç»“æœé›†ï¼Œå»ºè®®ä½¿ç”¨ <code>search_after</code> æˆ–æ»šåŠ¨ APIã€‚
        </p>
    </div>
  
    <h3 class="text-xl font-semibold text-indigo-600 mt-6 mb-3">æ’åº</h3>
    <p class="mb-2">ä½¿ç”¨ sort å‚æ•°æŒ‡å®šæ’åºå­—æ®µå’Œé¡ºåºï¼š</p>
  
<pre><code>GET /my_index/_search
{
  "query": {
    "match_all": {}
  },
  "sort": [
    { "publish_date": { "order": "desc" } },
    { "rating": { "order": "desc" } },
    "_score"
  ]
}</code></pre>

    <p class="mt-2">æ’åºå­—æ®µéœ€è¦æ˜¯æ•°å­—ã€æ—¥æœŸæˆ– keyword ç±»å‹ã€‚å¯¹äºæ–‡æœ¬å­—æ®µï¼Œé€šå¸¸ä½¿ç”¨å…¶ .keyword å­å­—æ®µè¿›è¡Œæ’åºã€‚</p>
  
    <h3 class="text-xl font-semibold text-indigo-600 mt-6 mb-3">Search After</h3>
    <p class="mb-2">å¯¹äºæ·±åº¦åˆ†é¡µï¼Œå¯ä»¥ä½¿ç”¨ search_after å®ç°ç‚¹å¯¹ç‚¹çš„åˆ†é¡µï¼Œé¿å…æ€§èƒ½é—®é¢˜ï¼š</p>
  
<pre><code>GET /my_index/_search
{
  "size": 10,
  "query": {
    "match": {
      "content": "elasticsearch"
    }
  },
  "sort": [
    { "publish_date": { "order": "desc" } },
    { "_id": { "order": "asc" } }
  ],
  "search_after": [1589570400000, "doc_id_123"]
}</code></pre>

    <p class="mt-2">search_after å‚æ•°åŸºäºä¸Šä¸€ä¸ªè¯·æ±‚è¿”å›çš„æœ€åä¸€ä¸ªæ–‡æ¡£çš„æ’åºå€¼ã€‚</p>
</section>

<section id="highlighting" class="mb-10">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">
        <i class="fas fa-highlighter mr-2"></i>6. é«˜äº®æœç´¢ç»“æœ
    </h2>
    <p class="mb-4">æœç´¢ç»“æœé«˜äº®åŠŸèƒ½å¯ä»¥è®©ç”¨æˆ·æ›´å®¹æ˜“çœ‹åˆ°åŒ¹é…çš„å†…å®¹ã€‚</p>
  
<pre><code>GET /my_index/_search
{
  "query": {
    "match": {
      "content": "elasticsearch"
    }
  },
  "highlight": {
    "fields": {
      "content": {}
    },
    "pre_tags": ["<strong>"],
    "post_tags": ["</strong>"]
  }
}</code></pre>

    <p class="mt-4">é«˜äº®æ˜¾ç¤ºçš„è‡ªå®šä¹‰é€‰é¡¹ï¼š</p>
    <ul class="list-disc list-inside ml-4 mb-4">
        <li><code>fragment_size</code>ï¼šæ¯ä¸ªé«˜äº®ç‰‡æ®µçš„å­—ç¬¦æ•°</li>
        <li><code>number_of_fragments</code>ï¼šè¿”å›çš„ç‰‡æ®µæ•°é‡</li>
        <li><code>require_field_match</code>ï¼šæ˜¯å¦åªé«˜äº®ä¸æŸ¥è¯¢åŒ¹é…çš„å­—æ®µ</li>
        <li><code>highlight_query</code>ï¼šè‡ªå®šä¹‰é«˜äº®æŸ¥è¯¢</li>
    </ul>
  
    <div class="bg-green-50 border-l-4 border-green-400 p-4 mt-3">
        <div class="flex">
            <div class="mr-3 text-green-500">
                <i class="fas fa-lightbulb text-xl"></i>
            </div>
            <p class="text-sm text-green-700">
                <strong>æç¤ºï¼š</strong> å¯¹äºé•¿æ–‡æœ¬å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>no_match_size</code> å‚æ•°æ§åˆ¶ä¸åŒ¹é…éƒ¨åˆ†çš„æ˜¾ç¤ºå¤§å°ï¼Œä»¥æä¾›æ›´å¥½çš„ä¸Šä¸‹æ–‡ã€‚
            </p>
        </div>
    </div>
</section>

<section id="performance-tips" class="mb-10">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">
        <i class="fas fa-bolt mr-2"></i>7. æ€§èƒ½ä¼˜åŒ–æç¤º
    </h2>
    <p class="mb-4">æŸ¥è¯¢å’Œèšåˆæ“ä½œå¯èƒ½å¾ˆè€—èµ„æºï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¼˜åŒ–æ€§èƒ½çš„å»ºè®®ï¼š</p>
  
    <div class="grid md:grid-cols-2 gap-4 mb-6">
        <div class="bg-indigo-50 p-4 rounded-lg">
            <h3 class="font-medium text-indigo-800 mb-2">æŸ¥è¯¢ä¼˜åŒ–</h3>
            <ul class="list-disc list-inside ml-2">
                <li>ä¼˜å…ˆä½¿ç”¨ filter è€Œé mustï¼Œå¯ç¼“å­˜ç»“æœ</li>
                <li>å°½é‡é¿å…ä½¿ç”¨é€šé…ç¬¦å‰ç¼€æŸ¥è¯¢ï¼ˆä¾‹å¦‚ *searchï¼‰</li>
                <li>ä½¿ç”¨æ›´å…·ä½“çš„æŸ¥è¯¢è€Œéå®½æ³›çš„æŸ¥è¯¢</li>
                <li>å¯¹äºå¤§å‹æ•°æ®é›†ä½¿ç”¨åˆé€‚çš„åˆ†é¡µç­–ç•¥</li>
            </ul>
        </div>
        <div class="bg-indigo-50 p-4 rounded-lg">
            <h3 class="font-medium text-indigo-800 mb-2">èšåˆä¼˜åŒ–</h3>
            <ul class="list-disc list-inside ml-2">
                <li>åœ¨èšåˆä¹‹å‰åº”ç”¨ç­›é€‰æ¡ä»¶</li>
                <li>é™åˆ¶èšåˆæ¡¶çš„æ•°é‡ï¼ˆterms.sizeï¼‰</li>
                <li>ä½¿ç”¨æ—¥æœŸç›´æ–¹å›¾æ—¶é€‰æ‹©åˆé€‚çš„æ—¶é—´é—´éš”</li>
                <li>å¯¹ä¸éœ€è¦çš„æœç´¢ç»“æœä½¿ç”¨ size: 0</li>
            </ul>
        </div>
    </div>
  
    <h3 class="text-xl font-semibold text-indigo-600 mb-3">ä½¿ç”¨ Filter Context</h3>
    <p class="mb-2">å°†ä¸å½±å“ç›¸å…³æ€§è¯„åˆ†çš„æ¡ä»¶æ”¾å…¥ filter contextï¼š</p>
  
<pre><code>GET /my_index/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "title": "elasticsearch" } }
      ],
      "filter": [
        { "term": { "status": "published" } },
        { "range": { "publish_date": { "gte": "now-1y" } } }
      ]
    }
  }
}</code></pre>

    <h3 class="text-xl font-semibold text-indigo-600 mt-6 mb-3">ç´¢å¼•å’Œå­—æ®µæ˜ å°„ä¼˜åŒ–</h3>
    <ul class="list-disc list-inside ml-4 mb-4">
        <li>ä¸ºéœ€è¦èšåˆçš„å­—æ®µå¯ç”¨ <code>doc_values</code>ï¼ˆé»˜è®¤å¯ç”¨ï¼‰</li>
        <li>ä¸ºéœ€è¦å…¨æ–‡æœç´¢çš„å­—æ®µå¯ç”¨åˆé€‚çš„åˆ†æå™¨</li>
        <li>å¯¹ä¸éœ€è¦åˆ†æçš„å­—æ®µä½¿ç”¨ <code>keyword</code> ç±»å‹</li>
        <li>é€‚å½“ä½¿ç”¨ <code>text</code> å­—æ®µçš„ <code>fielddata</code>ï¼ˆæ³¨æ„å†…å­˜æ¶ˆè€—ï¼‰</li>
    </ul>
</section>

<section id="conclusion" class="mb-10">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">
        <i class="fas fa-flag-checkered mr-2"></i>8. æ€»ç»“
    </h2>
    <p class="mb-4">Elasticsearch çš„æŸ¥è¯¢å’ŒèšåˆåŠŸèƒ½å¼ºå¤§è€Œçµæ´»ï¼Œèƒ½å¤Ÿæ»¡è¶³å„ç§å¤æ‚çš„æœç´¢å’Œæ•°æ®åˆ†æéœ€æ±‚ã€‚</p>
  
    <div class="bg-indigo-50 p-4 rounded-lg mb-6">
        <p class="font-medium text-indigo-800 mb-2">æŸ¥è¯¢ä¸èšåˆåŸºç¡€è¦ç‚¹ï¼š</p>
        <ul class="list-disc list-inside ml-4">
            <li>ç†è§£æŸ¥è¯¢ç±»å‹çš„å·®å¼‚ï¼ˆmatch vs termï¼‰</li>
            <li>æŒæ¡ bool æŸ¥è¯¢ç»„åˆå¤šä¸ªæ¡ä»¶</li>
            <li>ä½¿ç”¨ bucket èšåˆè¿›è¡Œæ•°æ®åˆ†ç»„</li>
            <li>ä½¿ç”¨ metric èšåˆè®¡ç®—ç»Ÿè®¡æ•°æ®</li>
            <li>ç»„åˆæŸ¥è¯¢å’Œèšåˆè¿›è¡Œå¤æ‚æ•°æ®åˆ†æ</li>
            <li>åº”ç”¨åˆé€‚çš„åˆ†é¡µå’Œæ’åºç­–ç•¥</li>
            <li>æ³¨æ„æ€§èƒ½ä¼˜åŒ–ï¼Œç‰¹åˆ«æ˜¯å¤§æ•°æ®é‡åœºæ™¯</li>
        </ul>
    </div>
  
    <p>éšç€å¯¹ Elasticsearch çš„æ·±å…¥äº†è§£ï¼Œæ‚¨å¯ä»¥æ¢ç´¢æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œå¦‚è·¨é›†ç¾¤æœç´¢ã€æœç´¢æ¨¡æ¿ã€å¼‚æ­¥æœç´¢ä»¥åŠæœºå™¨å­¦ä¹ é›†æˆç­‰ã€‚</p>
</section>
            </article>
        </main>
    </div>

    <script>
        // Mermaid initialization
        mermaid.initialize({
            startOnLoad: true,
            theme: 'neutral',
            flowchart: { useMaxWidth: true },
            securityLevel: 'loose'
        });
      
        // Mobile menu toggle
        const menuToggle = document.getElementById('menu-toggle');
        const closeMenu = document.getElementById('close-menu');
        const sidebar = document.getElementById('sidebar');
      
        menuToggle.addEventListener('click', () => {
            sidebar.classList.add('open');
        });
      
        closeMenu.addEventListener('click', () => {
            sidebar.classList.remove('open');
        });
      
        // Active link tracking
        const tocLinks = document.querySelectorAll('.toc-link');
        const sections = document.querySelectorAll('section[id]');
      
        function setActiveLink() {
            let scrollPosition = window.scrollY;
          
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                const sectionHeight = section.offsetHeight;
                const sectionId = section.getAttribute('id');
              
                if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                    tocLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === '#' + sectionId) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }
      
        window.addEventListener('scroll', setActiveLink);
      
        // Smooth scrolling for TOC links
        tocLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                const offsetTop = targetElement.offsetTop;
              
                window.scrollTo({
                    top: offsetTop - 20,
                    behavior: 'smooth'
                });
              
                // On mobile, close the menu after clicking a link
                if (window.innerWidth < 1024) {
                    sidebar.classList.remove('open');
                }
            });
        });
      
        // Initial call to set active link
        setActiveLink();
    </script>
</body>
</html>